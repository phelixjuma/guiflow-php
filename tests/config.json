[
  {
    "rule": "Get customers list",
    "stage": "get_customers_list",
    "description": "Gets list of customers from external source",
    "dependencies": [],
    "skip": "0",
    "condition": "always",
    "actions": [
      {
        "action": "function",
        "description": "Get the list of customers from external source",
        "stage": "get_customers_list",
        "dependencies": [],
        "skip": "0",
        "params": {
          "path": "customers_list",
          "function": "user_defined_function",
          "args": {
            "function_name": "get_master_data",
            "type": "customers"
          },
          "newField": "",
          "strict": "",
          "condition": ""
        }
      }
    ]
  },
  {
    "rule": "Match customer",
    "stage": "match_customers",
    "description": "Matches customer from external data using customer name",
    "dependencies": [
      "get_customers_list"
    ],
    "skip": "0",
    "condition": {
      "path": "customers_list",
      "operator": "exists"
    },
    "actions": [
      {
        "action": "function",
        "description": "",
        "stage": "search_customer",
        "dependencies": [],
        "skip": "0",
        "params": {
          "path": "customer_name",
          "function": "user_defined_function",
          "args": {
            "function_name": "semantic_search",
            "corpus": {
              "path": "customers_list"
            },
            "corpus_key": "BPNAME",
            "master_data_type": "customers",
            "similarity_threshold": "80"
          },
          "newField": "",
          "strict": "",
          "condition": ""
        }
      },
      {
        "action": "delete",
        "description": "Delete customers list",
        "stage": "delete_customer_list",
        "dependencies": [
          "search_customer"
        ],
        "skip": "0",
        "params": {
          "path": "customers_list"
        }
      }
    ]
  },
  {
    "rule": "Process Items",
    "stage": "process_items",
    "description": "",
    "dependencies": [],
    "skip": "0",
    "condition": "always",
    "actions": [
      {
        "action": "function",
        "description": "Get number of cases",
        "stage": "get_item_number_of_cases",
        "dependencies": [],
        "skip": "0",
        "params": {
          "path": "items.*.original_value.unit_of_measure",
          "function": "assoc_array_find",
          "args": {
            "condition": {
              "path": "selling_unit",
              "operator": "similar_to",
              "value": "Cases - CS",
              "similarity_threshold": "80",
              "tokenize_similarity": "0"
            },
            "return_field": "selling_quantity"
          },
          "newField": "items.*.original_value.number_of_cases",
          "strict": "",
          "condition": ""
        }
      }
    ]
  }
]
